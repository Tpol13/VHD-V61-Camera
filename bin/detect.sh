#!/bin/bash


INFO_FR=<<INFOEND
Ce script BASH est utilisé pour traiter des événements de surveillance vidéo géré par Motion.
Il fonctionne en réponse à deux types d'événements : "MovieStart" (démarrage de la vidéo) et "MovieEnd" (fin de la vidéo).
Lorsque l'événement est "MovieStart", il exécute ensuite un script PHP appelé "sendmail.php" pour envoyer un courrier électronique.
Lorsque l'événement est "MovieEnd", le script exécute un autre script PHP appelé "video2image.php" pour effectuer une tâche spécifique liée à la vidéo et enregistre les résultats dans le rapport.
Toutes ces actions et leurs résultats sont enregistrés dans rapport ayant un nom comportant le N° d'événement, de la date et de l'heure. Ceci pour un stockage et suivi ultérieurs.
Ce script BASH traite des événements de surveillance vidéo générés par Motion.
INFOEND

INFO_EN=<<INFOEND
This BASH script is used to handle video surveillance events managed by Motion.
It operates in response to two types of events: "MovieStart" (video start) and "MovieEnd" (video end).
When the event is "MovieStart," it then executes a PHP script called "sendmail.php" to send an email.
When the event is "MovieEnd," the script runs another PHP script called "video2image.php" to perform a specific video-related task and records the results in the report.
All of these actions and their outcomes are recorded in a report with a name containing the event number, date, and time. This is for later storage and tracking purposes.
This BASH script handles video surveillance events generated by Motion.
INFOEND


date="$4"
heure="$5"
event=$7
RAPPORT=/tmp/${event}
RAPPORT=/tmp/rapport_alarm.txt
#RAPPORT=/tmp/${3}-${4}_rapport_alarm.txt

# Option -- MovieStart file=/var/www/html/surveillance/medias//01-20220927144300.mkv date=20220927 heure=14:43:00 frame=01 event=xx
if [ "$2" == "MovieStart" ]; then
	> $RAPPORT
	echo "Sendmail.php: " >> $RAPPORT
	/usr/bin/php /var/www/html/surveillance/sendmail.php $* &>> $RAPPORT &
fi

declare -x >> $RAPPORT
echo Option $* >> $RAPPORT

if [ "$2" == "MovieEnd" ]; then
	/usr/bin/php /var/www/html/surveillance/video2image.php $* &>> $RAPPORT &
	newRAPPORT="/tmp/${event}_${date}_${heure}_rapport_alarm.txt"
	mv -f -- "$RAPPORT" ${newRAPPORT}
fi
